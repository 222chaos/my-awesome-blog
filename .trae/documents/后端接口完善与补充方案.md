# 后端接口完善与前端集成方案

## 一、后端缺失接口补充

### 1.1 用户密码更新接口
**位置**: `backend/app/api/v1/endpoints/users.py`
**需求**: 添加修改密码功能
```python
@router.put("/me/password", response_model=dict)
def update_password(
    *,
    db: Session = Depends(get_db),
    password_data: PasswordUpdate,
    current_user: UserModel = Depends(get_current_active_user)
) -> Any:
    """更新当前用户密码"""
    # 验证旧密码
    # 更新为新密码
    return {"message": "密码更新成功"}
```

### 1.2 取消订阅接口
**位置**: `backend/app/api/v1/endpoints/subscriptions.py`
**需求**: 用户可以取消自己的订阅
```python
@router.post("/unsubscribe", response_model=dict)
def unsubscribe(
    email: str,
    db: Session = Depends(get_db)
) -> Any:
    """取消订阅"""
```

### 1.3 留言取消点赞接口
**位置**: `backend/app/api/v1/endpoints/messages.py`
**需求**: 前端已有点赞，建议补充取消点赞
```python
@router.post("/{message_id}/unlike", response_model=Message)
def unlike_message(
    message_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
) -> Any:
    """取消点赞留言"""
```

---

## 二、前端服务层扩展

### 2.1 创建评论服务
**位置**: `frontend/src/services/commentService.ts`
**内容**: 创建评论相关的API调用函数
```typescript
- getComments(articleId: string): Promise<Comment[]>
- createComment(articleId: string, content: string): Promise<Comment>
- deleteComment(commentId: string): Promise<void>
- approveComment(commentId: string): Promise<Comment>
```

### 2.2 创建友链服务
**位置**: `frontend/src/services/friendLinkService.ts`
**内容**: 创建友链相关的API调用函数
```typescript
- getFriendLinks(): Promise<FriendLink[]>
```

### 2.3 创建订阅服务
**位置**: `frontend/src/services/subscriptionService.ts`
**内容**: 创建订阅相关的API调用函数
```typescript
- subscribe(email: string): Promise<Subscription>
- unsubscribe(email: string): Promise<void>
```

### 2.4 创建时间轴服务
**位置**: `frontend/src/services/timelineService.ts`
**内容**: 创建时间轴相关的API调用函数
```typescript
- getTimelineEvents(): Promise<TimelineEvent[]>
```

### 2.5 创建打字机内容服务
**位置**: `frontend/src/services/typewriterService.ts`
**内容**: 创建打字机内容API调用函数
```typescript
- getTypewriterContents(): Promise<TypewriterContent[]>
```

---

## 三、前端组件更新

### 3.1 Timeline组件
**位置**: `frontend/src/components/home/Timeline.tsx`
**更新**: 将mock数据替换为真实API调用
```typescript
// 从 mockEvents 改为从 API 获取
const [events, setEvents] = useState<TimelineEvent[]>([]);
useEffect(() => {
  getTimelineEvents().then(setEvents);
}, []);
```

### 3.2 SubscribeCard组件
**位置**: `frontend/src/components/home/SubscribeCard.tsx`
**更新**: 连接真实订阅API
```typescript
const handleSubscribe = async (email: string) => {
  await subscribe(email);
  // 显示成功提示
};
```

### 3.3 About页面
**位置**: `frontend/src/app/about/page.tsx`
**更新**: 从API获取友链数据
```typescript
const [friendLinks, setFriendLinks] = useState<FriendLink[]>([]);
useEffect(() => {
  getFriendLinks().then(setFriendLinks);
}, []);
```

---

## 四、Schema更新

### 4.1 添加密码更新Schema
**位置**: `backend/app/schemas/user.py`
```python
class PasswordUpdate(BaseModel):
    old_password: str
    new_password: str
```

---

## 五、CRUD操作补充

### 5.1 用户密码更新CRUD
**位置**: `backend/app/crud/user.py`
```python
def update_user_password(db: Session, user_id: UUID, old_password: str, new_password: str) -> bool:
    """更新用户密码"""
```

---

## 执行优先级

### 高优先级
1. 用户密码更新接口（前端已调用但后端缺失）
2. 取消留言点赞接口（前端可能需要）

### 中优先级
3. 评论服务层创建（文章详情页可能需要）
4. 友链服务层创建（About页面）

### 低优先级
5. 时间轴服务层创建（Timeline组件已有mock）
6. 打字机内容服务层创建（TextType组件可能需要）
7. 订阅服务层创建（SubscribeCard已有UI）