# åç«¯å®Œå–„æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

**é¡¹ç›®åç§°**: æˆ‘çš„ä¼˜ç§€åšå®¢ - åç«¯APIå®Œå–„
**åˆ›å»ºæ—¥æœŸ**: 2026-01-25
**ç›®æ ‡**: æ ¹æ®å‰ç«¯é¦–é¡µé‡æ„éœ€æ±‚ï¼Œå®Œå–„åç«¯APIä»¥æä¾›å®Œæ•´çš„æ•°æ®æ”¯æŒ
**æŠ€æœ¯æ ˆ**: FastAPI + SQLAlchemy + PostgreSQL + Redis

---

## 1. æ•°æ®åº“è®¾è®¡

### 1.1 æ–°å¢æ•°æ®æ¨¡å‹

#### 1.1.1 åˆ†ç±»è¡¨ (Category)

```sql
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    slug VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    color VARCHAR(7),  -- åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼Œå¦‚ #06B6D4
    icon VARCHAR(50),  -- å›¾æ ‡åç§°ï¼Œå¦‚ 'folder'
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_categories_slug ON categories(slug);
CREATE INDEX idx_categories_sort ON categories(sort_order);
```

#### 1.1.2 æ ‡ç­¾è¡¨ (Tag)

```sql
CREATE TABLE tags (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    slug VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    color VARCHAR(7),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_tags_slug ON tags(slug);
```

#### 1.1.3 æ–‡ç« -åˆ†ç±»å…³è”è¡¨ (ArticleCategory)

```sql
CREATE TABLE article_categories (
    article_id INTEGER REFERENCES articles(id) ON DELETE CASCADE,
    category_id INTEGER REFERENCES categories(id) ON DELETE CASCADE,
    is_primary BOOLEAN DEFAULT FALSE,
    PRIMARY KEY (article_id, category_id)
);

CREATE INDEX idx_article_category_article ON article_categories(article_id);
CREATE INDEX idx_article_category_category ON article_categories(category_id);
```

#### 1.1.4 æ–‡ç« -æ ‡ç­¾å…³è”è¡¨ (ArticleTag)

```sql
CREATE TABLE article_tags (
    article_id INTEGER REFERENCES articles(id) ON DELETE CASCADE,
    tag_id INTEGER REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (article_id, tag_id)
);

CREATE INDEX idx_article_tag_article ON article_tags(article_id);
CREATE INDEX idx_article_tag_tag ON article_tags(tag_id);
```

#### 1.1.5 å‹æƒ…é“¾æ¥è¡¨ (FriendLink)

```sql
CREATE TABLE friend_links (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    url VARCHAR(500) NOT NULL,
    favicon VARCHAR(500),
    avatar VARCHAR(500),
    description TEXT,
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    is_featured BOOLEAN DEFAULT FALSE,
    click_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_friend_links_sort ON friend_links(sort_order);
```

#### 1.1.6 ä½œå“é›†è¡¨ (Portfolio)

```sql
CREATE TABLE portfolios (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    slug VARCHAR(200) UNIQUE NOT NULL,
    description TEXT,
    cover_image VARCHAR(500),
    demo_url VARCHAR(500),
    github_url VARCHAR(500),
    technologies TEXT[],  -- PostgreSQLæ•°ç»„ç±»å‹
    start_date DATE,
    end_date DATE,
    status VARCHAR(20) DEFAULT 'completed',  -- completed, in_progress, planned
    is_featured BOOLEAN DEFAULT FALSE,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_portfolios_slug ON portfolios(slug);
CREATE INDEX idx_portfolios_sort ON portfolios(sort_order);
```

#### 1.1.7 æ—¶é—´è½´äº‹ä»¶è¡¨ (TimelineEvent)

```sql
CREATE TABLE timeline_events (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    event_date DATE NOT NULL,
    event_type VARCHAR(50) DEFAULT 'milestone',  -- milestone, achievement, update
    icon VARCHAR(50),
    color VARCHAR(7),
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_timeline_events_date ON timeline_events(event_date DESC);
CREATE INDEX idx_timeline_events_sort ON timeline_events(sort_order);
```

#### 1.1.8 è®¢é˜…è¡¨ (Subscription)

```sql
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    is_verified BOOLEAN DEFAULT FALSE,
    verification_token VARCHAR(100),
    subscribed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    verified_at TIMESTAMP WITH TIME ZONE,
    unsubscribed_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_subscriptions_email ON subscriptions(email);
CREATE INDEX idx_subscriptions_active ON subscriptions(is_active);
```

#### 1.1.9 å›¾ç‰‡è¡¨ (Image)

```sql
CREATE TABLE images (
    id SERIAL PRIMARY KEY,
    original_filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INTEGER NOT NULL,  -- å­—èŠ‚
    mime_type VARCHAR(50) NOT NULL,
    width INTEGER,
    height INTEGER,
    alt_text VARCHAR(255),
    caption TEXT,
    is_optimized BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_images_path ON images(file_path);
```

#### 1.1.10 å›¾ç‰‡å˜ä½“è¡¨ (ImageVariant)

```sql
CREATE TABLE image_variants (
    id SERIAL PRIMARY KEY,
    image_id INTEGER REFERENCES images(id) ON DELETE CASCADE,
    variant_name VARCHAR(50) NOT NULL,  -- thumbnail, small, medium, large, hero
    file_path VARCHAR(500) NOT NULL,
    width INTEGER NOT NULL,
    height INTEGER NOT NULL,
    file_size INTEGER NOT NULL,
    quality INTEGER DEFAULT 85,
    format VARCHAR(10) DEFAULT 'webp',  -- webp, jpeg, png
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(image_id, variant_name)
);

CREATE INDEX idx_image_variants_image ON image_variants(image_id);
CREATE INDEX idx_image_variants_variant ON image_variants(variant_name);
```

### 1.2 ä¿®æ”¹ç°æœ‰æ¨¡å‹

#### 1.2.1 æ‰©å±•Articleæ¨¡å‹

```sql
-- ä¸ºarticlesè¡¨æ·»åŠ æ–°å­—æ®µ
ALTER TABLE articles
ADD COLUMN read_time INTEGER,  -- é˜…è¯»æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
ADD COLUMN featured_image_id INTEGER REFERENCES images(id),
ADD COLUMN is_featured BOOLEAN DEFAULT FALSE,
ADD COLUMN is_pinned BOOLEAN DEFAULT FALSE,
ADD COLUMN meta_title VARCHAR(200),
ADD COLUMN meta_description TEXT;

CREATE INDEX idx_articles_featured ON articles(is_featured, published_at DESC);
CREATE INDEX idx_articles_pinned ON articles(is_pinned, published_at DESC);
```

#### 1.2.2 æ‰©å±•Useræ¨¡å‹

```sql
-- ä¸ºusersè¡¨æ·»åŠ æ–°å­—æ®µ
ALTER TABLE users
ADD COLUMN avatar VARCHAR(500),
ADD COLUMN bio TEXT,
ADD COLUMN website VARCHAR(200),
ADD COLUMN twitter VARCHAR(100),
ADD COLUMN github VARCHAR(100),
ADD COLUMN linkedin VARCHAR(100);
```

---

## 2. APIæ¥å£è®¾è®¡

### 2.1 åˆ†ç±»ç›¸å…³æ¥å£ (Categories)

#### 2.1.1 è·å–æ‰€æœ‰åˆ†ç±»

```
GET /api/v1/categories
```

**æŸ¥è¯¢å‚æ•°:**
- `is_active`: boolean - æ˜¯å¦åªè¿”å›æ¿€æ´»çš„åˆ†ç±» (é»˜è®¤: true)
- `with_count`: boolean - æ˜¯å¦åŒ…å«æ–‡ç« æ•°é‡ (é»˜è®¤: true)

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "name": "å‰ç«¯å¼€å‘",
  "slug": "frontend",
  "description": "å‰ç«¯æŠ€æœ¯ç›¸å…³æ–‡ç« ",
  "color": "#06B6D4",
  "icon": "code",
  "sort_order": 1,
  "article_count": 12,
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### 2.1.2 è·å–å•ä¸ªåˆ†ç±»

```
GET /api/v1/categories/{category_id}
```

#### 2.1.3 åˆ›å»ºåˆ†ç±» (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
POST /api/v1/categories
```

#### 2.1.4 æ›´æ–°åˆ†ç±» (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
PUT /api/v1/categories/{category_id}
```

#### 2.1.5 åˆ é™¤åˆ†ç±» (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
DELETE /api/v1/categories/{category_id}
```

---

### 2.2 æ ‡ç­¾ç›¸å…³æ¥å£ (Tags)

#### 2.2.1 è·å–æ‰€æœ‰æ ‡ç­¾

```
GET /api/v1/tags
```

**æŸ¥è¯¢å‚æ•°:**
- `with_count`: boolean - æ˜¯å¦åŒ…å«æ–‡ç« æ•°é‡ (é»˜è®¤: true)
- `limit`: integer - è¿”å›æ•°é‡é™åˆ¶ (é»˜è®¤: 50)
- `search`: string - æœç´¢å…³é”®è¯

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "name": "React",
  "slug": "react",
  "description": "Reactæ¡†æ¶ç›¸å…³",
  "color": "#61DAFB",
  "article_count": 15,
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### 2.2.2 è·å–çƒ­é—¨æ ‡ç­¾

```
GET /api/v1/tags/popular
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: integer - è¿”å›æ•°é‡ (é»˜è®¤: 10)

#### 2.2.3 åˆ›å»ºæ ‡ç­¾ (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
POST /api/v1/tags
```

---

### 2.3 æ–‡ç« ç›¸å…³æ¥å£æ‰©å±• (Articles)

#### 2.3.1 è·å–æ–‡ç« åˆ—è¡¨ï¼ˆå¢å¼ºç‰ˆï¼‰

```
GET /api/v1/articles
```

**æŸ¥è¯¢å‚æ•°:**
- `page`: integer - é¡µç  (é»˜è®¤: 1)
- `page_size`: integer - æ¯é¡µæ•°é‡ (é»˜è®¤: 10)
- `category_id`: integer - åˆ†ç±»ID
- `tag_id`: integer - æ ‡ç­¾ID
- `author_id`: integer - ä½œè€…ID
- `search`: string - æœç´¢å…³é”®è¯
- `sort`: string - æ’åºæ–¹å¼ (created_at, published_at, view_count, popular) (é»˜è®¤: created_at)
- `order`: string - æ’åºé¡ºåº (asc, desc) (é»˜è®¤: desc)
- `featured`: boolean - æ˜¯å¦åªè¿”å›ç²¾é€‰æ–‡ç« 
- `pinned`: boolean - æ˜¯å¦åªè¿”å›ç½®é¡¶æ–‡ç« 

**å“åº”ç¤ºä¾‹:**
```json
{
  "items": [
    {
      "id": 1,
      "title": "Next.js 14 å…¥é—¨æŒ‡å—",
      "slug": "nextjs-14-guide",
      "excerpt": "å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Next.js 14...",
      "cover_image": "/images/nextjs-hero-lg.webp",
      "read_time": 5,
      "category": {
        "id": 1,
        "name": "å‰ç«¯å¼€å‘",
        "slug": "frontend",
        "color": "#06B6D4"
      },
      "tags": [
        {"id": 1, "name": "Next.js", "slug": "nextjs"},
        {"id": 2, "name": "React", "slug": "react"}
      ],
      "author": {
        "id": 1,
        "username": "johndoe",
        "full_name": "John Doe",
        "avatar": "/avatars/john.jpg"
      },
      "view_count": 1250,
      "is_featured": true,
      "is_pinned": false,
      "published_at": "2024-01-15T00:00:00Z",
      "created_at": "2024-01-15T00:00:00Z"
    }
  ],
  "total": 105,
  "page": 1,
  "page_size": 10,
  "total_pages": 11
}
```

#### 2.3.2 è·å–çƒ­é—¨æ–‡ç« 

```
GET /api/v1/articles/popular
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: integer - è¿”å›æ•°é‡ (é»˜è®¤: 5)
- `days`: integer - ç»Ÿè®¡å¤©æ•° (é»˜è®¤: 30)

#### 2.3.3 è·å–ç²¾é€‰æ–‡ç« 

```
GET /api/v1/articles/featured
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: integer - è¿”å›æ•°é‡ (é»˜è®¤: 3)

#### 2.3.4 è·å–ç›¸å…³æ–‡ç« 

```
GET /api/v1/articles/{article_id}/related
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: integer - è¿”å›æ•°é‡ (é»˜è®¤: 4)

---

### 2.4 ç»Ÿè®¡æ•°æ®æ¥å£ (Statistics)

#### 2.4.1 è·å–ç½‘ç«™ç»Ÿè®¡æ•°æ®

```
GET /api/v1/statistics
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "articles": {
    "total": 105,
    "published": 95,
    "draft": 10
  },
  "categories": {
    "total": 12
  },
  "tags": {
    "total": 28
  },
  "views": {
    "total": 12500,
    "today": 250,
    "this_week": 1200,
    "this_month": 5000
  },
  "comments": {
    "total": 350,
    "pending": 15
  },
  "users": {
    "total": 150,
    "active": 120
  }
}
```

#### 2.4.2 è·å–åˆ†ç±»ç»Ÿè®¡

```
GET /api/v1/statistics/categories
```

**å“åº”ç¤ºä¾‹:**
```json
[
  {
    "id": 1,
    "name": "å‰ç«¯å¼€å‘",
    "slug": "frontend",
    "article_count": 12,
    "view_count": 2500
  }
]
```

#### 2.4.3 è·å–æ ‡ç­¾ç»Ÿè®¡

```
GET /api/v1/statistics/tags
```

**å“åº”ç¤ºä¾‹:**
```json
[
  {
    "id": 1,
    "name": "React",
    "slug": "react",
    "article_count": 15
  }
]
```

---

### 2.5 å‹æƒ…é“¾æ¥æ¥å£ (Friend Links)

#### 2.5.1 è·å–å‹æƒ…é“¾æ¥åˆ—è¡¨

```
GET /api/v1/friend-links
```

**æŸ¥è¯¢å‚æ•°:**
- `is_active`: boolean - æ˜¯å¦åªè¿”å›æ¿€æ´»çš„é“¾æ¥
- `is_featured`: boolean - æ˜¯å¦åªè¿”å›ç²¾é€‰é“¾æ¥
- `limit`: integer - è¿”å›æ•°é‡é™åˆ¶

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "name": "Next.js",
  "url": "https://nextjs.org",
  "favicon": "/images/favicons/nextjs.ico",
  "avatar": "/images/avatars/nextjs.png",
  "description": "ç”Ÿäº§å°±ç»ªçš„Reactæ¡†æ¶",
  "sort_order": 1,
  "click_count": 450,
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### 2.5.2 åˆ›å»ºå‹æƒ…é“¾æ¥ (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
POST /api/v1/friend-links
```

#### 2.5.3 è®°å½•å‹æƒ…é“¾æ¥ç‚¹å‡»

```
POST /api/v1/friend-links/{link_id}/click
```

---

### 2.6 ä½œå“é›†æ¥å£ (Portfolios)

#### 2.6.1 è·å–ä½œå“é›†åˆ—è¡¨

```
GET /api/v1/portfolios
```

**æŸ¥è¯¢å‚æ•°:**
- `is_featured`: boolean - æ˜¯å¦åªè¿”å›ç²¾é€‰ä½œå“
- `status`: string - çŠ¶æ€ç­›é€‰ (completed, in_progress, planned)
- `limit`: integer - è¿”å›æ•°é‡é™åˆ¶

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "title": "ç”µå•†å¹³å°",
  "slug": "ecommerce-platform",
  "description": "ä½¿ç”¨Reactå’ŒNode.jsæ„å»ºçš„å…¨åŠŸèƒ½ç”µå•†å¹³å°",
  "cover_image": "/images/portfolios/ecommerce-lg.webp",
  "demo_url": "https://demo.example.com",
  "github_url": "https://github.com/example/ecommerce",
  "technologies": ["React", "Node.js", "MongoDB", "Redis"],
  "start_date": "2023-01-01",
  "end_date": "2023-06-30",
  "status": "completed",
  "is_featured": true,
  "created_at": "2023-07-01T00:00:00Z"
}
```

#### 2.6.2 è·å–å•ä¸ªä½œå“é›†

```
GET /api/v1/portfolios/{portfolio_id}
```

---

### 2.7 æ—¶é—´è½´æ¥å£ (Timeline)

#### 2.7.1 è·å–æ—¶é—´è½´äº‹ä»¶

```
GET /api/v1/timeline
```

**æŸ¥è¯¢å‚æ•°:**
- `limit`: integer - è¿”å›æ•°é‡ (é»˜è®¤: 20)
- `event_type`: string - äº‹ä»¶ç±»å‹ç­›é€‰

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "title": "åšå®¢å¯åŠ¨",
  "description": "å¼€å§‹äº†æˆ‘çš„æŠ€æœ¯åšå®¢ï¼Œåˆ†äº«çŸ¥è¯†å’Œç»éªŒã€‚",
  "event_date": "2024-01-01",
  "event_type": "milestone",
  "icon": "rocket",
  "color": "#06B6D4",
  "sort_order": 1,
  "created_at": "2024-01-01T00:00:00Z"
}
```

---

### 2.8 è®¢é˜…æ¥å£ (Subscriptions)

#### 2.8.1 åˆ›å»ºè®¢é˜…

```
POST /api/v1/subscriptions
```

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "email": "user@example.com",
  "is_active": true,
  "is_verified": false,
  "message": "è®¢é˜…æˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±ä»¥éªŒè¯æ‚¨çš„è®¢é˜…ã€‚"
}
```

#### 2.8.2 éªŒè¯è®¢é˜…

```
GET /api/v1/subscriptions/verify/{token}
```

#### 2.8.3 å–æ¶ˆè®¢é˜…

```
POST /api/v1/subscriptions/unsubscribe
```

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com"
}
```

---

### 2.9 å›¾ç‰‡ä¸Šä¼ æ¥å£ (Images)

#### 2.9.1 ä¸Šä¼ å›¾ç‰‡

```
POST /api/v1/images/upload
```

**Content-Type:** `multipart/form-data`

**è¡¨å•å­—æ®µ:**
- `file`: æ–‡ä»¶ (å¿…éœ€)
- `alt_text`: å›¾ç‰‡æè¿°æ–‡æœ¬
- `caption`: å›¾ç‰‡æ ‡é¢˜

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 1,
  "original_filename": "hero-bg.jpg",
  "file_path": "/images/uploads/hero-bg-1234567890.jpg",
  "file_size": 2048000,
  "mime_type": "image/jpeg",
  "width": 1920,
  "height": 1080,
  "alt_text": "Hero background image",
  "caption": "Blog hero section",
  "variants": [
    {
      "variant_name": "hero",
      "file_path": "/images/uploads/hero-bg-hero.webp",
      "width": 1920,
      "height": 1080,
      "file_size": 512000,
      "format": "webp"
    },
    {
      "variant_name": "large",
      "file_path": "/images/uploads/hero-bg-lg.webp",
      "width": 1200,
      "height": 675,
      "file_size": 256000,
      "format": "webp"
    },
    {
      "variant_name": "medium",
      "file_path": "/images/uploads/hero-bg-md.webp",
      "width": 800,
      "height": 450,
      "file_size": 128000,
      "format": "webp"
    },
    {
      "variant_name": "small",
      "file_path": "/images/uploads/hero-bg-sm.webp",
      "width": 400,
      "height": 225,
      "file_size": 64000,
      "format": "webp"
    },
    {
      "variant_name": "thumbnail",
      "file_path": "/images/uploads/hero-bg-thumb.webp",
      "width": 150,
      "height": 150,
      "file_size": 12000,
      "format": "webp"
    }
  ],
  "created_at": "2024-01-25T00:00:00Z"
}
```

#### 2.9.2 è·å–å›¾ç‰‡ä¿¡æ¯

```
GET /api/v1/images/{image_id}
```

#### 2.9.3 åˆ é™¤å›¾ç‰‡ (éœ€è¦ç®¡ç†å‘˜æƒé™)

```
DELETE /api/v1/images/{image_id}
```

---

## 3. æ–‡ä»¶ç»“æ„

### 3.1 æ–°å¢æ¨¡å‹æ–‡ä»¶

```
backend/app/models/
â”œâ”€â”€ category.py           # åˆ†ç±»æ¨¡å‹
â”œâ”€â”€ tag.py                # æ ‡ç­¾æ¨¡å‹
â”œâ”€â”€ article_category.py   # æ–‡ç« -åˆ†ç±»å…³è”æ¨¡å‹
â”œâ”€â”€ article_tag.py        # æ–‡ç« -æ ‡ç­¾å…³è”æ¨¡å‹
â”œâ”€â”€ friend_link.py        # å‹æƒ…é“¾æ¥æ¨¡å‹
â”œâ”€â”€ portfolio.py          # ä½œå“é›†æ¨¡å‹
â”œâ”€â”€ timeline_event.py     # æ—¶é—´è½´äº‹ä»¶æ¨¡å‹
â”œâ”€â”€ subscription.py       # è®¢é˜…æ¨¡å‹
â””â”€â”€ image.py              # å›¾ç‰‡å’Œå›¾ç‰‡å˜ä½“æ¨¡å‹
```

### 3.2 æ–°å¢Schemaæ–‡ä»¶

```
backend/app/schemas/
â”œâ”€â”€ category.py           # åˆ†ç±» schemas
â”œâ”€â”€ tag.py                # æ ‡ç­¾ schemas
â”œâ”€â”€ friend_link.py        # å‹æƒ…é“¾æ¥ schemas
â”œâ”€â”€ portfolio.py          # ä½œå“é›† schemas
â”œâ”€â”€ timeline_event.py     # æ—¶é—´è½´äº‹ä»¶ schemas
â”œâ”€â”€ subscription.py       # è®¢é˜… schemas
â””â”€â”€ image.py              # å›¾ç‰‡ schemas
```

### 3.3 æ–°å¢CRUDæ–‡ä»¶

```
backend/app/crud/
â”œâ”€â”€ category.py
â”œâ”€â”€ tag.py
â”œâ”€â”€ friend_link.py
â”œâ”€â”€ portfolio.py
â”œâ”€â”€ timeline_event.py
â”œâ”€â”€ subscription.py
â””â”€â”€ image.py
```

### 3.4 æ–°å¢APIç«¯ç‚¹æ–‡ä»¶

```
backend/app/api/v1/endpoints/
â”œâ”€â”€ categories.py        # åˆ†ç±» API
â”œâ”€â”€ tags.py               # æ ‡ç­¾ API
â”œâ”€â”€ statistics.py        # ç»Ÿè®¡ API
â”œâ”€â”€ friend_links.py      # å‹æƒ…é“¾æ¥ API
â”œâ”€â”€ portfolios.py        # ä½œå“é›† API
â”œâ”€â”€ timeline.py          # æ—¶é—´è½´ API
â”œâ”€â”€ subscriptions.py     # è®¢é˜… API
â””â”€â”€ images.py            # å›¾ç‰‡ä¸Šä¼  API
```

### 3.5 æ–°å¢æœåŠ¡å±‚æ–‡ä»¶

```
backend/app/services/
â”œâ”€â”€ image_service.py     # å›¾ç‰‡å¤„ç†æœåŠ¡
â”œâ”€â”€ statistics_service.py # ç»Ÿè®¡æ•°æ®æœåŠ¡
â”œâ”€â”€ cache_service.py     # ç¼“å­˜æœåŠ¡
â””â”€â”€ email_service.py     # é‚®ä»¶æœåŠ¡
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 4.1 å›¾ç‰‡å¤„ç†æœåŠ¡

#### 4.1.1 å›¾ç‰‡ä¸Šä¼ å’Œå‹ç¼©

ä½¿ç”¨ `Pillow` å’Œ `imageio` è¿›è¡Œå›¾ç‰‡å¤„ç†ï¼š

```python
# backend/app/services/image_service.py
from PIL import Image
import os
from typing import List, Dict
from pathlib import Path

class ImageService:
    # é¢„å®šä¹‰çš„å›¾ç‰‡å°ºå¯¸
    IMAGE_SIZES = {
        'hero': (1920, 1080),
        'large': (1200, 675),
        'medium': (800, 450),
        'small': (400, 225),
        'thumbnail': (150, 150)
    }

    @staticmethod
    def compress_and_create_variants(
        original_path: str,
        output_dir: str,
        filename: str,
        quality: int = 85
    ) -> Dict:
        """
        å‹ç¼©å›¾ç‰‡å¹¶åˆ›å»ºå¤šä¸ªå°ºå¯¸å˜ä½“
        """
        variants = []
        original_image = Image.open(original_path)
        width, height = original_image.size

        # è·å–æ–‡ä»¶æ‰©å±•åï¼ˆä¸åŒ…å«ç‚¹ï¼‰
        ext = Path(original_path).suffix.lower()

        # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
        base_filename = Path(filename).stem
        unique_suffix = str(int(time.time()))

        # éå†æ‰€æœ‰é¢„å®šä¹‰çš„å°ºå¯¸
        for variant_name, target_size in ImageService.IMAGE_SIZES.items():
            # è®¡ç®—ä¿æŒå®½é«˜æ¯”çš„å°ºå¯¸
            target_width, target_height = target_size
            ratio = min(target_width / width, target_height / height)
            new_width = int(width * ratio)
            new_height = int(height * ratio)

            # ç¼©æ”¾å›¾ç‰‡
            resized_image = original_image.resize(
                (new_width, new_height),
                Image.LANCZOS
            )

            # ç”Ÿæˆè¾“å‡ºæ–‡ä»¶å
            output_filename = f"{base_filename}-{unique_suffix}-{variant_name}.webp"
            output_path = os.path.join(output_dir, output_filename)

            # ä¿å­˜ä¸ºWebPæ ¼å¼
            resized_image.save(
                output_path,
                'WEBP',
                quality=quality,
                method=6  # æ›´é«˜çš„å‹ç¼©ç‡
            )

            # è·å–æ–‡ä»¶å¤§å°
            file_size = os.path.getsize(output_path)

            variants.append({
                'variant_name': variant_name,
                'file_path': f"/images/uploads/{output_filename}",
                'width': new_width,
                'height': new_height,
                'file_size': file_size,
                'quality': quality,
                'format': 'webp'
            })

        return {
            'variants': variants,
            'original_width': width,
            'original_height': height,
            'total_size': sum(v['file_size'] for v in variants)
        }

    @staticmethod
    def optimize_image(
        image_path: str,
        quality: int = 85,
        max_size: tuple = None
    ) -> tuple:
        """
        ä¼˜åŒ–å•å¼ å›¾ç‰‡
        """
        image = Image.open(image_path)

        # å¦‚æœéœ€è¦è°ƒæ•´å¤§å°
        if max_size:
            image.thumbnail(max_size, Image.LANCZOS)

        # è½¬æ¢ä¸ºRGBï¼ˆå¦‚æœæ˜¯RGBAï¼‰
        if image.mode == 'RGBA':
            image = image.convert('RGB')

        # ä¿å­˜ä¸ºWebP
        output_path = image_path.replace(
            Path(image_path).suffix,
            '.webp'
        )
        image.save(output_path, 'WEBP', quality=quality)

        return output_path, os.path.getsize(output_path)
```

#### 4.1.2 å›¾ç‰‡ä¸Šä¼ ç«¯ç‚¹

```python
# backend/app/api/v1/endpoints/images.py
from fastapi import APIRouter, Depends, UploadFile, File, HTTPException, status
from sqlalchemy.orm import Session
from app.core.database import get_db
from app.core.dependencies import get_current_active_user
from app.schemas.image import ImageUploadResponse
from app.services.image_service import ImageService
from app.models.user import User
import os
import time

router = APIRouter()

UPLOAD_DIR = "public/images/uploads"
os.makedirs(UPLOAD_DIR, exist_ok=True)

ALLOWED_MIME_TYPES = [
    'image/jpeg',
    'image/png',
    'image/webp',
    'image/gif'
]
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

@router.post("/upload", response_model=ImageUploadResponse)
async def upload_image(
    *,
    db: Session = Depends(get_db),
    file: UploadFile = File(...),
    alt_text: str = None,
    caption: str = None,
    current_user: User = Depends(get_current_active_user)
):
    """
    ä¸Šä¼ å›¾ç‰‡å¹¶è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªå°ºå¯¸çš„WebPå˜ä½“
    """
    # éªŒè¯æ–‡ä»¶ç±»å‹
    if file.content_type not in ALLOWED_MIME_TYPES:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=f"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: {file.content_type}"
        )

    # è¯»å–æ–‡ä»¶
    content = await file.read()

    # éªŒè¯æ–‡ä»¶å¤§å°
    if len(content) > MAX_FILE_SIZE:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=f"æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ (æœ€å¤§ {MAX_FILE_SIZE / 1024 / 1024}MB)"
        )

    # ä¿å­˜åŸå§‹æ–‡ä»¶
    original_filename = file.filename
    timestamp = str(int(time.time()))
    base_name = Path(original_filename).stem
    extension = Path(original_filename).suffix

    # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
    unique_filename = f"{base_name}-{timestamp}{extension}"
    original_path = os.path.join(UPLOAD_DIR, unique_filename)

    with open(original_path, "wb") as f:
        f.write(content)

    # å¤„ç†å›¾ç‰‡å¹¶ç”Ÿæˆå˜ä½“
    try:
        result = ImageService.compress_and_create_variants(
            original_path,
            UPLOAD_DIR,
            original_filename
        )

        # åˆ›å»ºå›¾ç‰‡è®°å½•ï¼ˆéœ€è¦åœ¨æ•°æ®åº“ä¸­å®ç°ï¼‰
        # db_image = crud.create_image(...)

        return ImageUploadResponse(
            id=1,  # å®é™…åº”è¯¥ä»æ•°æ®åº“è·å–
            original_filename=original_filename,
            file_path=f"/images/uploads/{unique_filename}",
            file_size=len(content),
            mime_type=file.content_type,
            width=result['original_width'],
            height=result['original_height'],
            alt_text=alt_text,
            caption=caption,
            is_optimized=True,
            variants=result['variants']
        )

    except Exception as e:
        # æ¸…ç†ä¸Šä¼ çš„æ–‡ä»¶
        if os.path.exists(original_path):
            os.remove(original_path)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"å›¾ç‰‡å¤„ç†å¤±è´¥: {str(e)}"
        )
```

---

### 4.2 ç»Ÿè®¡æ•°æ®æœåŠ¡

#### 4.2.1 ç»Ÿè®¡æœåŠ¡å®ç°

```python
# backend/app/services/statistics_service.py
from sqlalchemy.orm import Session
from sqlalchemy import func
from app.models.article import Article
from app.models.category import Category
from app.models.tag import Tag
from app.models.comment import Comment
from app.models.user import User
from datetime import datetime, timedelta
from typing import Dict

class StatisticsService:
    @staticmethod
    def get_website_statistics(db: Session) -> Dict:
        """
        è·å–ç½‘ç«™ç»¼åˆç»Ÿè®¡æ•°æ®
        """
        # æ–‡ç« ç»Ÿè®¡
        total_articles = db.query(func.count(Article.id)).scalar()
        published_articles = db.query(func.count(Article.id)).filter(
            Article.is_published == True
        ).scalar()
        draft_articles = total_articles - published_articles

        # åˆ†ç±»ç»Ÿè®¡
        total_categories = db.query(func.count(Category.id)).scalar()

        # æ ‡ç­¾ç»Ÿè®¡
        total_tags = db.query(func.count(Tag.id)).scalar()

        # è¯„è®ºç»Ÿè®¡
        total_comments = db.query(func.count(Comment.id)).scalar()

        # ç”¨æˆ·ç»Ÿè®¡
        total_users = db.query(func.count(User.id)).scalar()
        active_users = db.query(func.count(User.id)).filter(
            User.is_active == True
        ).scalar()

        return {
            "articles": {
                "total": total_articles,
                "published": published_articles,
                "draft": draft_articles
            },
            "categories": {
                "total": total_categories
            },
            "tags": {
                "total": total_tags
            },
            "comments": {
                "total": total_comments
            },
            "users": {
                "total": total_users,
                "active": active_users
            }
        }

    @staticmethod
    def get_view_statistics(db: Session) -> Dict:
        """
        è·å–æµè§ˆé‡ç»Ÿè®¡
        """
        # æ€»æµè§ˆé‡
        total_views = db.query(func.sum(Article.view_count)).scalar() or 0

        # ä»Šæ—¥æµè§ˆé‡ï¼ˆå‡è®¾åœ¨æ›´æ–°æ–‡ç« æ—¶æœ‰ updated_at å­—æ®µï¼‰
        today = datetime.utcnow().date()
        today_views = db.query(func.sum(Article.view_count)).filter(
            func.date(Article.updated_at) == today
        ).scalar() or 0

        # æœ¬å‘¨æµè§ˆé‡
        week_ago = datetime.utcnow() - timedelta(days=7)
        week_views = db.query(func.sum(Article.view_count)).filter(
            Article.updated_at >= week_ago
        ).scalar() or 0

        # æœ¬æœˆæµè§ˆé‡
        month_ago = datetime.utcnow() - timedelta(days=30)
        month_views = db.query(func.sum(Article.view_count)).filter(
            Article.updated_at >= month_ago
        ).scalar() or 0

        return {
            "total": total_views,
            "today": today_views,
            "this_week": week_views,
            "this_month": month_views
        }

    @staticmethod
    def get_category_statistics(db: Session) -> list:
        """
        è·å–åˆ†ç±»ç»Ÿè®¡ï¼ˆåŒ…å«æ–‡ç« æ•°é‡å’Œæµè§ˆé‡ï¼‰
        """
        # éœ€è¦å®ç° article_categories å…³è”è¡¨åçš„æŸ¥è¯¢
        return []

    @staticmethod
    def get_tag_statistics(db: Session, limit: int = 50) -> list:
        """
        è·å–æ ‡ç­¾ç»Ÿè®¡ï¼ˆæŒ‰æ–‡ç« æ•°é‡æ’åºï¼‰
        """
        # éœ€è¦å®ç° article_tags å…³è”è¡¨åçš„æŸ¥è¯¢
        return []
```

---

### 4.3 ç¼“å­˜æœåŠ¡

#### 4.3.1 Redisç¼“å­˜å®ç°

```python
# backend/app/services/cache_service.py
import redis
import json
from typing import Optional, Any
from app.core.config import settings

class CacheService:
    def __init__(self):
        self.redis_client = redis.Redis(
            host=settings.REDIS_HOST,
            port=settings.REDIS_PORT,
            db=settings.REDIS_DB,
            decode_responses=True
        )

    def get(self, key: str) -> Optional[Any]:
        """
        ä»ç¼“å­˜è·å–æ•°æ®
        """
        value = self.redis_client.get(key)
        if value:
            return json.loads(value)
        return None

    def set(self, key: str, value: Any, expire: int = 3600):
        """
        è®¾ç½®ç¼“å­˜æ•°æ®
        """
        self.redis_client.setex(
            key,
            expire,
            json.dumps(value, default=str)
        )

    def delete(self, key: str):
        """
        åˆ é™¤ç¼“å­˜
        """
        self.redis_client.delete(key)

    def invalidate_pattern(self, pattern: str):
        """
        åˆ é™¤åŒ¹é…æ¨¡å¼çš„æ‰€æœ‰ç¼“å­˜
        """
        keys = self.redis_client.keys(pattern)
        if keys:
            self.redis_client.delete(*keys)

# ç¼“å­˜é”®å‰ç¼€
CACHE_KEYS = {
    'statistics': 'stats:website',
    'categories': 'categories:list',
    'tags': 'tags:list',
    'popular_articles': 'articles:popular',
    'featured_articles': 'articles:featured'
}
```

---

## 5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 5.1 æ•°æ®åº“ä¼˜åŒ–

#### 5.1.1 æ·»åŠ ç´¢å¼•

```sql
-- æ–‡ç« è¡¨ç´¢å¼•
CREATE INDEX idx_articles_published ON articles(is_published, published_at DESC);
CREATE INDEX idx_articles_view_count ON articles(view_count DESC);
CREATE INDEX idx_articles_created ON articles(created_at DESC);

-- è¯„è®ºè¡¨ç´¢å¼•
CREATE INDEX idx_comments_article ON comments(article_id);
CREATE INDEX idx_comments_created ON comments(created_at DESC);
```

#### 5.1.2 æ•°æ®åº“è¿æ¥æ± é…ç½®

```python
# backend/app/core/database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

engine = create_engine(
    settings.DATABASE_URL,
    pool_size=10,
    max_overflow=20,
    pool_pre_ping=True,
    pool_recycle=3600
)

SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)
```

### 5.2 APIå“åº”ä¼˜åŒ–

#### 5.2.1 åˆ†é¡µå“åº”ä¼˜åŒ–

ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µè€Œéåç§»åˆ†é¡µï¼š

```python
# backend/app/crud/article.py
def get_articles_cursor(
    db: Session,
    cursor: Optional[int] = None,
    limit: int = 10,
    published_only: bool = True
):
    """
    ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µè·å–æ–‡ç« ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
    """
    query = db.query(Article)

    if published_only:
        query = query.filter(Article.is_published == True)

    if cursor:
        query = query.filter(Article.id < cursor)

    articles = query.order_by(Article.id.desc()).limit(limit).all()

    next_cursor = articles[-1].id if articles else None

    return {
        'items': articles,
        'next_cursor': next_cursor,
        'has_more': len(articles) == limit
    }
```

#### 5.2.2 å“åº”å­—æ®µé€‰æ‹©

å…è®¸å®¢æˆ·ç«¯æŒ‡å®šéœ€è¦è¿”å›çš„å­—æ®µï¼š

```python
@router.get("/articles")
async def get_articles(
    fields: str = Query("id,title,excerpt,cover_image,published_at")
):
    """
    æ”¯æŒå­—æ®µé€‰æ‹©çš„æ–‡ç« åˆ—è¡¨æ¥å£
    """
    field_list = fields.split(',')
    # åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
    query = db.query(*[getattr(Article, field) for field in field_list])
    # ...
```

---

## 6. å®æ–½è®¡åˆ’

### é˜¶æ®µ1: æ•°æ®åº“è®¾è®¡å’Œè¿ç§»ï¼ˆ1å‘¨ï¼‰

- [ ] è®¾è®¡æ‰€æœ‰æ–°è¡¨ç»“æ„
- [ ] åˆ›å»ºAlembicè¿ç§»è„šæœ¬
- [ ] è¿è¡Œè¿ç§»
- [ ] æ·»åŠ ç´¢å¼•ä¼˜åŒ–

### é˜¶æ®µ2: æ¨¡å‹å’ŒSchemaå±‚ï¼ˆ1å‘¨ï¼‰

- [ ] åˆ›å»ºæ‰€æœ‰æ•°æ®æ¨¡å‹
- [ ] åˆ›å»ºæ‰€æœ‰Pydantic schemas
- [ ] å®ç°æ¨¡å‹å…³è”å…³ç³»

### é˜¶æ®µ3: CRUDå±‚ï¼ˆ1å‘¨ï¼‰

- [ ] å®ç°æ‰€æœ‰æ¨¡å—çš„CRUDæ“ä½œ
- [ ] æ·»åŠ ä¸šåŠ¡é€»è¾‘éªŒè¯
- [ ] å®ç°å…³è”æŸ¥è¯¢ä¼˜åŒ–

### é˜¶æ®µ4: æœåŠ¡å±‚ï¼ˆ1å‘¨ï¼‰

- [ ] å®ç°å›¾ç‰‡å¤„ç†æœåŠ¡
- [ ] å®ç°ç»Ÿè®¡æ•°æ®æœåŠ¡
- [ ] å®ç°ç¼“å­˜æœåŠ¡
- [ ] å®ç°é‚®ä»¶æœåŠ¡

### é˜¶æ®µ5: APIç«¯ç‚¹ï¼ˆ2å‘¨ï¼‰

- [ ] å®ç°åˆ†ç±»ç›¸å…³æ¥å£
- [ ] å®ç°æ ‡ç­¾ç›¸å…³æ¥å£
- [ ] æ‰©å±•æ–‡ç« æ¥å£
- [ ] å®ç°ç»Ÿè®¡æ•°æ®æ¥å£
- [ ] å®ç°å‹æƒ…é“¾æ¥æ¥å£
- [ ] å®ç°ä½œå“é›†æ¥å£
- [ ] å®ç°æ—¶é—´è½´æ¥å£
- [ ] å®ç°è®¢é˜…æ¥å£
- [ ] å®ç°å›¾ç‰‡ä¸Šä¼ æ¥å£

### é˜¶æ®µ6: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] APIæ–‡æ¡£å®Œå–„

---

## 7. æŠ€æœ¯æ ˆå’Œä¾èµ–

### æ–°å¢ä¾èµ–

```python
# requirements.txt
Pillow>=10.0.0              # å›¾ç‰‡å¤„ç†
redis>=5.0.0                # ç¼“å­˜
python-multipart>=0.0.6      # æ–‡ä»¶ä¸Šä¼ 
email-validator>=2.1.0       # é‚®ç®±éªŒè¯
celery>=5.3.0                # å¼‚æ­¥ä»»åŠ¡ï¼ˆé‚®ä»¶å‘é€ï¼‰
```

### ç¯å¢ƒå˜é‡

```env
# .env
DATABASE_URL=postgresql://postgres:password@localhost:5432/my_awesome_blog

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-password
SMTP_FROM=your-email@gmail.com

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_MAX_SIZE=10485760  # 10MB
ALLOWED_IMAGE_TYPES=jpeg,png,webp,gif

# ç¼“å­˜é…ç½®
CACHE_TTL=3600  # 1å°æ—¶
```

---

## 8. å®‰å…¨è€ƒè™‘

### 8.1 æ–‡ä»¶ä¸Šä¼ å®‰å…¨

- éªŒè¯æ–‡ä»¶ç±»å‹ï¼ˆMIME type + æ–‡ä»¶å¤´ï¼‰
- é™åˆ¶æ–‡ä»¶å¤§å°
- é‡å‘½åä¸Šä¼ æ–‡ä»¶ï¼ˆé˜²æ­¢è·¯å¾„éå†ï¼‰
- ç¦æ­¢æ‰§è¡Œä¸Šä¼ ç›®å½•ä¸­çš„æ–‡ä»¶

### 8.2 APIå®‰å…¨

- æ‰€æœ‰ä¿®æ”¹æ“ä½œéœ€è¦è®¤è¯
- ç®¡ç†å‘˜æƒé™éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨ORMå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- XSSé˜²æŠ¤ï¼ˆè¾“å…¥éªŒè¯å’Œè¾“å‡ºè½¬ä¹‰ï¼‰
- CSRFé˜²æŠ¤

### 8.3 é‚®ç®±éªŒè¯

- è®¢é˜…é‚®ç®±éœ€è¦éªŒè¯
- ç”Ÿæˆä¸€æ¬¡æ€§éªŒè¯token
- éªŒè¯tokenæœ‰æ•ˆæœŸé™åˆ¶ï¼ˆ24å°æ—¶ï¼‰

---

## 9. ç›‘æ§å’Œæ—¥å¿—

### 9.1 APIæ€§èƒ½ç›‘æ§

- è®°å½•æ‰€æœ‰APIè¯·æ±‚çš„å“åº”æ—¶é—´
- è®°å½•æ…¢æŸ¥è¯¢ï¼ˆ>1ç§’ï¼‰
- ç›‘æ§é”™è¯¯ç‡

### 9.2 æ–‡ä»¶ä¸Šä¼ ç›‘æ§

- è®°å½•ä¸Šä¼ æ–‡ä»¶å¤§å°
- è®°å½•å›¾ç‰‡å¤„ç†æ—¶é—´
- ç›‘æ§å­˜å‚¨ä½¿ç”¨é‡

---

## 10. æ–‡æ¡£å’Œæµ‹è¯•

### 10.1 APIæ–‡æ¡£

- ä½¿ç”¨FastAPIè‡ªåŠ¨ç”Ÿæˆçš„Swaggeræ–‡æ¡£
- æ¯ä¸ªç«¯ç‚¹éƒ½æœ‰è¯¦ç»†çš„æè¿°
- æä¾›è¯·æ±‚/å“åº”ç¤ºä¾‹

### 10.2 æµ‹è¯•è¦†ç›–

- å•å…ƒæµ‹è¯•ï¼šè¦†ç›–ç‡ > 80%
- é›†æˆæµ‹è¯•ï¼šä¸»è¦ä¸šåŠ¡æµç¨‹
- æ€§èƒ½æµ‹è¯•ï¼šå…³é”®æ¥å£å“åº”æ—¶é—´ < 200ms

---

## é™„å½•

### A. æ•°æ®åº“ERå›¾

```
Users (ç”¨æˆ·)
  â†“ 1:N
Articles (æ–‡ç« )
  â†“ N:M
Categories (åˆ†ç±»)
  â†“ N:M
Tags (æ ‡ç­¾)

Articles â† N:1 â†’ Comments (è¯„è®º)
Articles â† N:1 â†’ Images (å›¾ç‰‡)
Images â† 1:N â†’ ImageVariants (å›¾ç‰‡å˜ä½“)

FriendLinks (å‹æƒ…é“¾æ¥)
Portfolios (ä½œå“é›†)
TimelineEvents (æ—¶é—´è½´äº‹ä»¶)
Subscriptions (è®¢é˜…)
```

### B. APIå“åº”ç è§„èŒƒ

- `200 OK` - è¯·æ±‚æˆåŠŸ
- `201 Created` - åˆ›å»ºæˆåŠŸ
- `400 Bad Request` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401 Unauthorized` - æœªè®¤è¯
- `403 Forbidden` - æ— æƒé™
- `404 Not Found` - èµ„æºä¸å­˜åœ¨
- `422 Unprocessable Entity` - æ•°æ®éªŒè¯å¤±è´¥
- `429 Too Many Requests` - è¯·æ±‚é¢‘ç‡é™åˆ¶
- `500 Internal Server Error` - æœåŠ¡å™¨é”™è¯¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-25
**ç»´æŠ¤è€…**: åç«¯å¼€å‘å›¢é˜Ÿ
