# API 端点文档

本文档详细介绍了 My Awesome Blog 项目中新增的 API 端点。

## 1. 缓存相关

目前缓存功能主要在服务层实现，没有直接的API端点。

## 2. 游标分页端点

### 2.1 获取分页文章列表（游标分页）

- **URL**: `/api/v1/articles/cursor-paginated`
- **方法**: `GET`
- **认证**: 无需认证
- **参数**:
  - `cursor` (可选): Base64编码的游标字符串，用于分页
  - `limit` (可选): 每页项目数量，默认为20，最大为100
  - `published_only` (可选): 是否只返回已发布的文章，默认为true
  - `author_id` (可选): 按作者ID过滤
  - `search` (可选): 搜索关键词
- **响应**:
  ```json
  {
    "items": [...],           // 文章列表
    "next_cursor": "string",  // 下一页游标，如果没有更多数据则为null
    "has_more": true          // 是否有更多数据
  }
  ```

## 3. 全文搜索端点

### 3.1 文章全文搜索

- **URL**: `/api/v1/articles/search-fulltext`
- **方法**: `GET`
- **认证**: 无需认证
- **参数**:
  - `search_query` (必填): 搜索查询字符串，长度1-100字符
  - `published_only` (可选): 是否只搜索已发布的文章，默认为true
  - `skip` (可选): 跳过的项目数，默认为0
  - `limit` (可选): 返回的最大项目数，默认为100，最大为100
- **响应**: 返回匹配的文章列表

## 4. 审计日志端点

### 4.1 获取审计日志列表

- **URL**: `/api/v1/audit-logs/`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `skip` (可选): 跳过的记录数，默认为0
  - `limit` (可选): 返回的最大记录数，默认为100，最大为1000
  - `user_id` (可选): 按用户ID过滤
  - `action` (可选): 按操作类型过滤
  - `resource_type` (可选): 按资源类型过滤
- **响应**: 返回审计日志列表

### 4.2 获取特定用户的审计日志

- **URL**: `/api/v1/audit-logs/user/{user_id}`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **路径参数**:
  - `user_id`: 用户ID
- **查询参数**:
  - `skip` (可选): 跳过的记录数，默认为0
  - `limit` (可选): 返回的最大记录数，默认为100，最大为1000
- **响应**: 返回特定用户的审计日志列表

### 4.3 获取特定操作类型的审计日志

- **URL**: `/api/v1/audit-logs/action/{action}`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **路径参数**:
  - `action`: 操作类型
- **查询参数**:
  - `skip` (可选): 跳过的记录数，默认为0
  - `limit` (可选): 返回的最大记录数，默认为100，最大为1000
- **响应**: 返回特定操作类型的审计日志列表

## 5. 数据分析端点

### 5.1 文章增长统计

- **URL**: `/api/v1/analytics/growth-stats`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `days` (可选): 分析的天数，默认为30，范围1-365
- **响应**: 返回文章增长统计数据

### 5.2 用户参与度统计

- **URL**: `/api/v1/analytics/engagement-stats`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `days` (可选): 分析的天数，默认为30，范围1-365
- **响应**: 返回用户参与度统计数据

### 5.3 顶级作者（按文章数）

- **URL**: `/api/v1/analytics/top-authors-by-articles`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `limit` (可选): 返回的作者数量，默认为10，范围1-50
- **响应**: 返回发布文章最多的作者列表

### 5.4 顶级作者（按浏览量）

- **URL**: `/api/v1/analytics/top-authors-by-views`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `limit` (可选): 返回的作者数量，默认为10，范围1-50
- **响应**: 返回总浏览量最高的作者列表

### 5.5 月度统计

- **URL**: `/api/v1/analytics/monthly-stats`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **参数**:
  - `months` (可选): 分析的月数，默认为6，范围1-24
- **响应**: 返回月度统计信息

### 5.6 内容洞察

- **URL**: `/api/v1/analytics/content-insights`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **响应**: 返回内容洞察数据

### 5.7 仪表板摘要

- **URL**: `/api/v1/analytics/dashboard-summary`
- **方法**: `GET`
- **认证**: 需要超级用户权限
- **响应**: 返回仪表板摘要信息

## 6. 文章管理端点（已更新）

### 6.1 更新文章

- **URL**: `/api/v1/articles/{article_id}`
- **方法**: `PUT`
- **认证**: 需要认证用户
- **路径参数**:
  - `article_id`: 文章ID
- **请求体**: `ArticleUpdate` 模型
- **响应**: 返回更新后的文章信息
- **注意**: 此端点现在会清除相关的缓存

### 6.2 删除文章

- **URL**: `/api/v1/articles/{article_id}`
- **方法**: `DELETE`
- **认证**: 需要超级用户权限
- **路径参数**:
  - `article_id`: 文章ID
- **响应**: 返回成功消息
- **注意**: 此端点现在会清除相关的缓存

## 7. 错误响应格式

所有API端点现在使用统一的错误响应格式：

```json
{
  "success": false,
  "error": "ERROR_CODE_STRING",
  "error_code": "ERROR_CODE_ENUM",
  "message": "错误消息",
  "details": {
    // 附加的错误详情（可选）
  }
}
```

## 8. 权限说明

- 普通用户：可以访问大部分文章、评论等公共信息
- 认证用户：可以创建和更新自己的内容
- 超级用户：可以访问所有功能，包括审计日志和数据分析端点