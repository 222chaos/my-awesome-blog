---
name: 音乐馆动效优化计划
overview: 为音乐馆页面添加Apple Music风格的精致动画效果，包括页面加载淡入、卡片3D交互、滚动触发、播放可视化、HeroBanner视差和列表交错动画
design:
  architecture:
    framework: react
  fontSystem:
    fontFamily: PingFang SC
    heading:
      size: 24px
      weight: 600
    subheading:
      size: 18px
      weight: 500
    body:
      size: 14px
      weight: 400
  colorSystem:
    primary:
      - "#6366f1"
      - "#ec4899"
      - "#8b5cf6"
    background:
      - "#0a0a1a"
      - "#1a1a2e"
      - "#252542"
    text:
      - "#ffffff"
      - rgba(255,255,255,0.8)
      - rgba(255,255,255,0.5)
    functional:
      - "#22c55e"
      - "#ef4444"
      - "#f59e0b"
todos:
  - id: install-framer-motion
    content: 安装 Framer Motion 动画库
    status: completed
  - id: create-mouse-hook
    content: 创建 useMousePosition hook 用于视差和3D效果
    status: completed
  - id: create-animated-section
    content: 创建 AnimatedSection 可复用滚动触发动画组件
    status: completed
  - id: optimize-hero-banner
    content: HeroBanner 添加鼠标视差效果
    status: completed
    dependencies:
      - create-mouse-hook
  - id: optimize-playlist-card
    content: PlaylistCard 添加3D倾斜和光晕扫过效果
    status: completed
    dependencies:
      - create-mouse-hook
  - id: optimize-artist-card
    content: ArtistCard 添加3D倾斜效果
    status: completed
    dependencies:
      - create-mouse-hook
  - id: optimize-song-row
    content: SongRow 优化播放声波动画
    status: completed
  - id: optimize-player-bar
    content: PlayerBar 播放时专辑封面旋转动画
    status: completed
  - id: optimize-page-animations
    content: 音乐馆页面添加加载动画和滚动触发
    status: completed
    dependencies:
      - create-animated-section
  - id: add-css-animations
    content: globals.css 添加新动画keyframes和变量
    status: completed
---

## 用户核心需求

为音乐馆页面添加高级视觉动效，提升整体质感和用户体验，参考 Apple Music 风格。

## 核心功能

1. **页面加载动画** - HeroBanner、推荐歌单、最新音乐、热门歌手各区块依次淡入
2. **卡片3D交互** - PlaylistCard 和 ArtistCard 鼠标悬停时的 3D 倾斜效果 + 光晕扫过动画
3. **滚动触发动画** - 元素进入视口时触发的入场动画
4. **播放状态可视化** - 播放中的专辑封面旋转、更精致的声波动画
5. **HeroBanner 视差效果** - 鼠标移动时背景与封面产生视差
6. **歌曲列表交错动画** - 列表项依次滑入显示

## 视觉效果

- 深色主题 (#0a0a1a) + 玻璃拟态 (backdrop-blur)
- Indigo (#6366f1) 到 Pink (#ec4899) 渐变强调色
- 流畅的弹簧动画曲线 (cubic-bezier)

## 技术栈

- **框架**: React + TypeScript + Next.js
- **样式**: Tailwind CSS + CSS Variables
- **动画**: Framer Motion + CSS Animations

## 实现方案

### 1. 动画架构

使用 Framer Motion 实现复杂的 React 组件动画，CSS Animations 处理简单的持续动画。

### 2. 核心动效实现策略

**页面加载动画**:

- 使用 `motion.div` 包裹各区块
- `initial={{ opacity: 0, y: 30 }}` -> `animate={{ opacity: 1, y: 0 }}`
- 通过 `transition.delay` 实现依次出现 (stagger: 0.15s)

**卡片3D交互**:

- 使用 `useMotionValue` 和 `useTransform` 跟踪鼠标位置
- 计算相对于卡片中心的偏移，转换为旋转角度 (rotateX/Y: ±10deg)
- CSS `::before` 伪元素实现光晕扫过效果 (conic-gradient + rotate)

**滚动触发动画**:

- 封装 `useInView` hook 或使用 Framer Motion 的 `whileInView`
- 视口进入时触发动画，离开时暂停

**播放状态可视化**:

- CSS `@keyframes spin` 实现专辑封面旋转
- 重新设计声波动画，4根柱子不同相位律动

**HeroBanner 视差**:

- `useMotionValue` 跟踪鼠标坐标
- 背景图片使用 `x: mouseX * 0.02`, 封面使用 `x: mouseX * -0.05`

**歌曲列表交错**:

- Framer Motion `variants` 配合 `staggerChildren: 0.05`

### 3. 性能优化

- `will-change: transform` 声明 GPU 加速
- 使用 `motion.div` 的 `layoutId` 避免重排
- 鼠标事件使用 `requestAnimationFrame` 节流

## 目录结构

```
frontend/src/
├── components/music/
│   ├── PlaylistCard.tsx          # [MODIFY] 添加3D倾斜+光晕效果
│   ├── ArtistCard.tsx            # [MODIFY] 添加3D倾斜效果
│   ├── HeroBanner.tsx            # [MODIFY] 添加视差效果
│   ├── SongRow.tsx               # [MODIFY] 优化播放声波动画
│   ├── PlayerBar.tsx             # [MODIFY] 播放中专辑封面旋转
│   ├── PlaylistScroll.tsx        # [MODIFY] 滚动动画容器
│   ├── ArtistScroll.tsx          # [MODIFY] 滚动动画容器
│   └── AnimatedSection.tsx       # [NEW] 可复用的滚动触发动画组件
├── hooks/
│   └── useMousePosition.ts       # [NEW] 鼠标位置追踪hook
├── app/music/page.tsx            # [MODIFY] 页面加载交错动画
└── app/music/globals.css         # [MODIFY] 添加新动画keyframes
```

## Agent Extensions

### Skill

- **ui-ux-pro-max**
- Purpose: 提供专业的 UI/UX 设计建议，确保动效设计符合现代设计规范
- Expected outcome: 验证动画参数（时长、缓动曲线）的合理性，确保视觉效果达到 Apple Music 级别